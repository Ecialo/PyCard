#: import Label kivy.uix.label
#: import TextInput kivy.uix.textinput
#: import BoxLayout kivy.uix.boxlayout
#: import Button kivy.uix.button
#: import Popup kivy.uix.popup
#: import ScrollView kivy.uix.scrollview
#: import sla kivy.adapters.simplelistadapter


<ControlButton@Widget>:
    size_hint_y: None
    height: dp(30)

<ClickableLabel@ButtonBehavior+Label>
<MyButton@ControlButton+Button>

<MyCheckBox@RelativeLayout+ControlButton+ButtonBehavior>:
    id: __layout
    active: __cb.active
    state: __cb.state
    text: 'Default text'

    CheckBox:
        id: __cb
        size_hint_x: None
        pos: (-35, 0)

    ClickableLabel:
        id: __label
        size_hint_x: None
        pos: (15, 0)

        text: __layout.text
        on_press: __cb._do_press()


<LobbyScreen@Screen>:
    BoxLayout:
        orientation: 'vertical'

        BoxLayout:
            id: top_view
            size_hint_y: 1
            orientation: 'horizontal'

            GridLayout:
                id: buttons_view
                cols: 3
                rows: 1

                MyCheckBox:
                    id: ready_checkbox
                    text: "I am ready"

                MyButton:
                    text: "Options"
                    disabled: True

                MyButton:
                    text: "Exit"
                    on_press: app.stop()
            
            BoxLayout:
                size_hint_y: 1

            BoxLayout:
                id: users_view
                orientation: 'vertical'
                size_hint_x: None
                width: min(0.25 * root.width, dp(200))

                Label:
                    id: users_caption
                    text: "Players online:"
                    size_hint_y: None
                    height: min(dp(self.font_size * 2), root.height * 0.1)

                ListView:
                    id: users
                    size_hint_y: 0.85
                    adapter:
                        sla.SimpleListAdapter(data=app.users, cls=Label.Label)

        ScrollView:
            id: chatlog_view
            size_hint_y: None
            height: min(0.3 * root.height, dp(160))

            Label:
                id: chatlog
                halign: 'left'
                valign: 'top'

                # add a 5px margin around the texture
                text_size: self.width - dp(10), None

                # make label scrollable
                size_hint_y: None
                height: self.texture_size[1]

        TextInput:
            id: input_field
            size_hint_y: None

            height: dp(self.font_size * 2)
            multiline: False
            on_text_validate: app.send_chat_message()


<GameScreen@Screen>:
    BoxLayout:
        MyButton:
            text: "You should be playing right now."
            on_press: root.manager.current = 'lobby'


<ConnectionWidget@Popup>:
    title: 'Connection settings'
    size: (350, 200)
    size_hint: (None, None)
    auto_dismiss: False

    BoxLayout:
        orientation: 'vertical'
        spacing: 4

        GridLayout:
            size_hint_y: 0.7
            cols: 2
            rows: 3

            Label:
                size_hint_x: 0.4
                text: 'Server:'

            TextInput:
                id: server
                multiline: False
                write_tab: False
                text: 'localhost'

            Label:
                size_hint_x: 0.4
                text: 'Port:'

            TextInput:
                id: port
                multiline: False
                write_tab: False
                input_filter: 'int'
                text: '8000'

            Label:
                size_hint_x: 0.4
                text: 'Your name:'

            TextInput:
                id: name
                multiline: False
                write_tab: False
                text: 'Tester'

        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: 0.3

            Button:
                text: 'Connect'
                on_press: root.dismiss(); app.player_name = name.text; app.connect_to_server(host=server.text, port=int(port.text))

            Button:
                text: 'Cancel'
                on_press: root.dismiss()
